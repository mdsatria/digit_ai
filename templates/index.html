<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MNIST Prediction</title>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial;
    background: linear-gradient(135deg,#667eea,#764ba2);
    text-align:center;
    padding:40px;
}

.container{
    background:white;
    padding:30px;
    border-radius:15px;
    width:800px;
    margin:auto;
}

canvas{
    border:3px solid #667eea;
    background:white;
}

button{
    padding:10px 20px;
    margin:10px;
    font-size:16px;
    cursor:pointer;
}

#result{
    font-size:40px;
    margin-top:20px;
    color:#667eea;
}
</style>
</head>

<body>

<div class="container">

<h2>Handwritten Digit Prediction</h2>

<canvas id="canvas" width="280" height="280"></canvas>
<br>

<button id="clear">Clear</button>
<button id="predict">Predict</button>

<div id="result">No prediction yet</div>
<div id="confidence"></div>

<canvas id="chart" width="400" height="200"></canvas>

</div>

<script src="{{ url_for('static',filename='index.js') }}"></script>

<script>

let chart;

$("#predict").click(function(){

    let canvas = document.getElementById("canvas");
    let img = canvas.toDataURL();

    $.ajax({
        type: "POST",
        url: "/predict/",
        data: img,
        success: function(data){

            $("#result").text("Prediction: " + data.label);
            $("#confidence").text(
                "Confidence: " +
                (data.confidence*100).toFixed(2) + "%"
            );

            const labels =
            ['0','1','2','3','4','5','6','7','8','9'];

            if(chart){ chart.destroy(); }

            chart = new Chart(
                document.getElementById("chart"),
                {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Probability",
                            data: data.probs
                        }]
                    },
                    options:{
                        scales:{
                            y:{
                                beginAtZero:true,
                                max:1
                            }
                        }
                    }
                }
            );
        }
    });
});

$("#clear").click(function(){
    location.reload();
});

</script>

</body>
</html>
